<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/login.css" />
    <title>Iniciar Sesión</title>
</head>
<body>
    <form id="login-form" class="login-form">
        <p class="login-text">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-lock fa-stack-1x"></i>
            </span>
        </p>
        <input type="email" class="login-username" autofocus="true" required="true" placeholder="Email" id="email" />
        <input type="password" class="login-password" required="true" placeholder="Password" id="password" />
        <button type="button" class="login-submit">Login</button>
    </form>
    <a href="#" class="login-forgot-pass">forgot password?</a>
    <div class="underlay-photo"></div>
    <div class="underlay-black"></div>
    
    <div class="api-container">
        <h2>Tendencias de Moda</h2>
        <div id="fashion-trends"></div>
    </div>
    
    <script>
      document.querySelector('.login-submit').addEventListener('click', async function(event) {
          var email = document.getElementById('email').value;
          var password = document.getElementById('password').value;
          if (!email || !password) {
              alert('Por favor, complete todos los campos.');
              event.preventDefault();
          } else {
              // Aquí puedes llamar a la función para procesar la autenticación
              const authHeaders = await getAuthenticationHeaders();
              // Luego puedes realizar llamadas a la API de Revery con los encabezados de autenticación
              await fetchFashionTrends(authHeaders);
          }
      });

      async function getAuthenticationHeaders() {
          const publicKey = 'tu_clave_publica';
          const secretKey = 'tu_clave_secreta';
          const time = Math.floor(Date.now() / 1000);
          const derivedKey = await pbkdf2(publicKey, secretKey, time.toString(), 128, 32, 'sha256');
          return {
              "public_key": publicKey,
              "one_time_code": derivedKey,
              "timestamp": time,
              'Content-Type': 'application/json',
              Accept: 'application/json',
          };
      }

      async function pbkdf2(publicKey, secretKey, time, iterations, keyLength, digest) {
          // Implementa aquí tu función pbkdf2 para generar la clave derivada
          // Puedes utilizar bibliotecas como bcrypt.js o crypto-js
      }

      async function fetchFashionTrends(authHeaders) {
          const response = await fetch('https://api.revery.ai/console/v2/get_filtered_garments', {
              method: 'GET',
              headers: authHeaders,
          });
          const data = await response.json();
          const trendsContainer = document.getElementById('fashion-trends');
          trendsContainer.innerHTML = ''; // Limpia los elementos anteriores
          if (data.success) {
              data.garments.forEach(garment => {
                  const garmentItem = document.createElement('div');
                  garmentItem.className = 'garment-item';
                  garmentItem.innerHTML = `
                      <img src="${garment.image_urls.product_image}" alt="${garment.id}">
                  `;
                  trendsContainer.appendChild(garmentItem);
              });
          } else {
              alert('Error al obtener tendencias de moda');
          }
      }
  </script>
</body>
</html>